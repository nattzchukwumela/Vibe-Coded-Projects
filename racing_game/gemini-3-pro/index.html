<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Simple 3D Racer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
        }

        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 40px;
            text-align: center;
            display: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <div id="score">Score: 0</div>
    <div id="game-over">
        CRASHED!<br>
        <button onclick="location.reload()">Try Again</button>
    </div>

    <!-- Import Three.js from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- 1. SETUP THE SCENE ---
        const scene = new THREE.Scene();
        // Add some fog for depth perception
        scene.fog = new THREE.Fog(0xa0a0a0, 10, 50);
        scene.background = new THREE.Color(0xa0a0a0);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 3, 6); // Position camera behind and above
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // Enable shadows
        document.body.appendChild(renderer.domElement);

        // --- 2. LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(10, 20, 0);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- 3. GAME OBJECTS ---

        // The Floor (Road)
        const roadGeo = new THREE.PlaneGeometry(14, 1000);
        const roadMat = new THREE.MeshPhongMaterial({ color: 0x333333 });
        const road = new THREE.Mesh(roadGeo, roadMat);
        road.rotation.x = -Math.PI / 2;
        road.position.z = -400; // Extend road far back
        road.receiveShadow = true;
        scene.add(road);

        // Grass/Ground on sides
        const groundGeo = new THREE.PlaneGeometry(200, 1000);
        const groundMat = new THREE.MeshPhongMaterial({ color: 0x2b8c2b });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.1; // Slightly below road
        ground.position.z = -400;
        scene.add(ground);

        // The Player (Car)
        const carGroup = new THREE.Group();

        // Car Body
        const bodyGeo = new THREE.BoxGeometry(1.2, 0.5, 2);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0xe74c3c }); // Red car
        const carBody = new THREE.Mesh(bodyGeo, bodyMat);
        carBody.position.y = 0.5;
        carBody.castShadow = true;
        carGroup.add(carBody);

        // Car Wheels (Simple black boxes)
        const wheelGeo = new THREE.BoxGeometry(0.4, 0.4, 0.6);
        const wheelMat = new THREE.MeshLambertMaterial({ color: 0x000000 });

        const w1 = new THREE.Mesh(wheelGeo, wheelMat); w1.position.set(-0.7, 0.2, 0.6);
        const w2 = new THREE.Mesh(wheelGeo, wheelMat); w2.position.set(0.7, 0.2, 0.6);
        const w3 = new THREE.Mesh(wheelGeo, wheelMat); w3.position.set(-0.7, 0.2, -0.6);
        const w4 = new THREE.Mesh(wheelGeo, wheelMat); w4.position.set(0.7, 0.2, -0.6);

        carGroup.add(w1, w2, w3, w4);

        scene.add(carGroup);

        // --- 4. GAME VARIABLES ---
        let obstacles = [];
        let gameSpeed = 0.5;
        let score = 0;
        let isGameOver = false;

        // Controls
        let playerX = 0;
        let speedX = 0;
        const maxSpeedX = 0.4;

        const keys = { ArrowLeft: false, ArrowRight: false };

        // Input Listeners
        window.addEventListener('keydown', (e) => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = true;
        });
        window.addEventListener('keyup', (e) => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = false;
        });

        // Helper to create obstacles
        function spawnObstacle() {
            const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
            const material = new THREE.MeshPhongMaterial({ color: 0x3498db }); // Blue box
            const obstacle = new THREE.Mesh(geometry, material);

            obstacle.castShadow = true;
            obstacle.receiveShadow = true;

            // Random X position (-5 to 5)
            obstacle.position.x = (Math.random() * 10) - 5;
            obstacle.position.y = 0.75;
            obstacle.position.z = -60; // Spawn far away

            scene.add(obstacle);
            obstacles.push(obstacle);
        }

        // --- 5. GAME LOOP ---
        function animate() {
            if (isGameOver) return;

            requestAnimationFrame(animate);

            // 1. Player Movement logic
            if (keys.ArrowLeft) speedX = -maxSpeedX;
            else if (keys.ArrowRight) speedX = maxSpeedX;
            else speedX *= 0.9; // Friction/slow down

            playerX += speedX;

            // Keep player on road boundaries
            if (playerX > 6) playerX = 6;
            if (playerX < -6) playerX = -6;

            carGroup.position.x = playerX;

            // Lean effect when turning
            carGroup.rotation.z = -speedX * 0.5;

            // 2. Obstacle Logic
            // Spawn new obstacles randomly
            if (Math.random() < 0.03) { // 3% chance per frame
                spawnObstacle();
            }

            // Move and clean up obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.position.z += gameSpeed; // Move towards camera

                // Simple Collision Detection (Box overlap)
                let dist = Math.abs(obs.position.x - carGroup.position.x);
                let depthDist = Math.abs(obs.position.z - carGroup.position.z);

                // If objects are close in X and Z axes
                if (dist < 1.2 && depthDist < 1.5) {
                    isGameOver = true;
                    document.getElementById('game-over').style.display = 'block';
                }

                // Remove if passed camera
                if (obs.position.z > 10) {
                    scene.remove(obs);
                    obstacles.splice(i, 1);
                    score += 10;
                    document.getElementById('score').innerText = "Score: " + score;

                    // Increase difficulty
                    if (score % 100 === 0) gameSpeed += 0.05;
                }
            }

            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start the game
        animate();

    </script>
</body>

</html>