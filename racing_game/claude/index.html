<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Racing Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1a2e;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .game-container {
            position: relative;
        }

        canvas {
            border: 4px solid #4a4a6a;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 200, 255, 0.3);
        }

        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .hud div {
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 5px;
        }

        .speedometer {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            border: 4px solid #00ff88;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #00ff88;
        }

        .speedometer .speed-value {
            font-size: 36px;
            font-weight: bold;
        }

        .speedometer .speed-label {
            font-size: 14px;
        }

        .start-screen,
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 10px;
        }

        .start-screen h1,
        .game-over-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #00ff88;
            text-shadow: 0 0 20px #00ff88;
        }

        .start-screen p,
        .game-over-screen p {
            font-size: 18px;
            margin: 10px 0;
            color: #aaa;
        }

        button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 24px;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border: none;
            border-radius: 30px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .controls-info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .controls-info h3 {
            color: #00ccff;
            margin-bottom: 10px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div class="hud hidden" id="hud">
            <div>üèÅ Score: <span id="score">0</span></div>
            <div>‚è±Ô∏è Time: <span id="time">0</span>s</div>
            <div>‚ù§Ô∏è Lives: <span id="lives">3</span></div>
        </div>

        <div class="speedometer hidden" id="speedometer">
            <span class="speed-value" id="speedValue">0</span>
            <span class="speed-label">MPH</span>
        </div>

        <div class="start-screen" id="startScreen">
            <h1>üèéÔ∏è TURBO RACER</h1>
            <p>Race through traffic and survive as long as possible!</p>
            <div class="controls-info">
                <h3>Controls</h3>
                <p>‚¨ÖÔ∏è ‚û°Ô∏è Arrow Keys - Steer</p>
                <p>‚¨ÜÔ∏è Arrow Up - Accelerate</p>
                <p>‚¨áÔ∏è Arrow Down - Brake</p>
            </div>
            <button onclick="startGame()">START RACE</button>
        </div>

        <div class="game-over-screen hidden" id="gameOverScreen">
            <h1>üí• GAME OVER</h1>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Distance: <span id="finalDistance">0</span>m</p>
            <button onclick="startGame()">RACE AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let gameTime = 0;
        let lastTime = 0;

        // Road properties
        const roadWidth = 2000;
        const segmentLength = 200;
        const rumbleLength = 3;
        const drawDistance = 100;
        const cameraHeight = 1000;
        const cameraDepth = 0.84;
        const fieldOfView = 100;

        // Player properties
        let player = {
            x: 0,
            z: 0,
            speed: 0,
            maxSpeed: 300,
            accel: 200,
            decel: 100,
            brake: 400,
            turnSpeed: 3
        };

        // Road segments
        let segments = [];
        let trackLength = 0;

        // Traffic cars
        let cars = [];
        const carColors = ['#ff4444', '#44ff44', '#4444ff', '#ffff44', '#ff44ff', '#44ffff'];

        // Input
        let keys = {
            left: false,
            right: false,
            up: false,
            down: false
        };

        // Initialize road
        function initRoad() {
            segments = [];

            // Create road segments with curves
            for (let i = 0; i < 500; i++) {
                let curve = 0;
                let hill = 0;

                // Add curves
                if (i > 50 && i < 100) curve = 2;
                if (i > 150 && i < 200) curve = -3;
                if (i > 250 && i < 350) curve = 1.5;
                if (i > 400 && i < 450) curve = -2;

                // Add hills
                if (i > 75 && i < 125) hill = 20;
                if (i > 200 && i < 250) hill = -15;
                if (i > 300 && i < 350) hill = 25;

                segments.push({
                    index: i,
                    p1: { world: { z: i * segmentLength }, camera: {}, screen: {} },
                    p2: { world: { z: (i + 1) * segmentLength }, camera: {}, screen: {} },
                    curve: curve,
                    hill: hill,
                    color: Math.floor(i / rumbleLength) % 2 ?
                        { road: '#666666', grass: '#10aa10', rumble: '#ff0000' } :
                        { road: '#555555', grass: '#009900', rumble: '#ffffff' }
                });
            }

            trackLength = segments.length * segmentLength;
        }

        // Initialize cars
        function initCars() {
            cars = [];
            for (let i = 0; i < 20; i++) {
                cars.push({
                    x: (Math.random() - 0.5) * 1.5,
                    z: Math.random() * trackLength,
                    speed: 50 + Math.random() * 100,
                    color: carColors[Math.floor(Math.random() * carColors.length)],
                    width: 80,
                    height: 60
                });
            }
        }

        // Project 3D to 2D
        function project(p, cameraX, cameraY, cameraZ) {
            let scale = cameraDepth / (p.world.z - cameraZ);
            p.screen.x = Math.round(canvas.width / 2 + scale * (p.world.x - cameraX) * canvas.width / 2);
            p.screen.y = Math.round(canvas.height / 2 - scale * (p.world.y - cameraY) * canvas.height / 2);
            p.screen.w = Math.round(scale * roadWidth * canvas.width / 2);
            p.screen.scale = scale;
        }

        // Find segment by Z position
        function findSegment(z) {
            return segments[Math.floor(z / segmentLength) % segments.length];
        }

        // Draw polygon
        function drawPolygon(ctx, x1, y1, x2, y2, x3, y3, x4, y4, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x3, y3);
            ctx.lineTo(x4, y4);
            ctx.closePath();
            ctx.fill();
        }

        // Draw car
        function drawCar(ctx, x, y, scale, color, isPlayer = false) {
            const width = 80 * scale;
            const height = 50 * scale;

            // Car body
            ctx.fillStyle = color;
            ctx.fillRect(x - width / 2, y - height, width, height);

            // Windshield
            ctx.fillStyle = '#333';
            ctx.fillRect(x - width / 3, y - height * 0.9, width * 0.66, height * 0.4);

            // Wheels
            ctx.fillStyle = '#222';
            ctx.fillRect(x - width / 2 - 5 * scale, y - height * 0.3, 10 * scale, height * 0.3);
            ctx.fillRect(x + width / 2 - 5 * scale, y - height * 0.3, 10 * scale, height * 0.3);

            if (isPlayer) {
                // Headlights
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(x - width / 2 + 5 * scale, y - height, 10 * scale, 5 * scale);
                ctx.fillRect(x + width / 2 - 15 * scale, y - height, 10 * scale, 5 * scale);
            }
        }

        // Update game
        function update(dt) {
            if (!gameRunning) return;

            gameTime += dt;

            // Handle input
            if (keys.up) {
                player.speed += player.accel * dt;
            } else if (keys.down) {
                player.speed -= player.brake * dt;
            } else {
                player.speed -= player.decel * dt;
            }

            player.speed = Math.max(0, Math.min(player.maxSpeed, player.speed));

            // Steering
            if (player.speed > 0) {
                if (keys.left) {
                    player.x -= player.turnSpeed * (player.speed / player.maxSpeed) * dt;
                }
                if (keys.right) {
                    player.x += player.turnSpeed * (player.speed / player.maxSpeed) * dt;
                }
            }

            // Apply curve
            let segment = findSegment(player.z);
            player.x -= segment.curve * (player.speed / player.maxSpeed) * dt * 2;

            // Keep player on road
            if (player.x < -1.5 || player.x > 1.5) {
                player.speed *= 0.95;
                player.x = Math.max(-1.5, Math.min(1.5, player.x));
            }

            // Move player
            player.z += player.speed * dt;
            if (player.z >= trackLength) {
                player.z -= trackLength;
            }

            // Update cars
            cars.forEach(car => {
                car.z += car.speed * dt;
                if (car.z >= trackLength) {
                    car.z -= trackLength;
                }

                // Check collision
                let carDist = Math.abs(car.z - player.z);
                if (carDist < segmentLength) {
                    let carX = car.x * roadWidth / 2;
                    let playerX = player.x * roadWidth / 2;
                    if (Math.abs(carX - playerX) < 100) {
                        // Collision!
                        lives--;
                        player.speed = 0;
                        car.z = player.z + 5000;

                        if (lives <= 0) {
                            gameOver();
                        }
                    }
                }
            });

            // Update score
            score = Math.floor(player.z / 100);

            // Update HUD
            document.getElementById('score').textContent = score;
            document.getElementById('time').textContent = Math.floor(gameTime);
            document.getElementById('lives').textContent = lives;
            document.getElementById('speedValue').textContent = Math.floor(player.speed * 2);
        }

        // Render game
        function render() {
            // Clear canvas
            ctx.fillStyle = '#72d7ee';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw sun
            ctx.fillStyle = '#ffff88';
            ctx.beginPath();
            ctx.arc(650, 80, 50, 0, Math.PI * 2);
            ctx.fill();

            // Draw mountains
            ctx.fillStyle = '#4a7c4e';
            ctx.beginPath();
            ctx.moveTo(0, 250);
            ctx.lineTo(150, 150);
            ctx.lineTo(300, 220);
            ctx.lineTo(450, 120);
            ctx.lineTo(600, 200);
            ctx.lineTo(750, 100);
            ctx.lineTo(800, 180);
            ctx.lineTo(800, 250);
            ctx.closePath();
            ctx.fill();

            let baseSegment = findSegment(player.z);
            let baseIndex = baseSegment.index;
            let cameraX = player.x * roadWidth / 2;
            let cameraY = cameraHeight;
            let cameraZ = player.z - cameraDepth * segmentLength;
            let maxy = canvas.height;

            let x = 0;
            let dx = 0;

            // Draw road segments
            for (let n = 0; n < drawDistance; n++) {
                let segIndex = (baseIndex + n) % segments.length;
                let segment = segments[segIndex];

                segment.p1.world.x = x;
                segment.p1.world.y = segment.hill;
                segment.p2.world.x = x + dx;
                segment.p2.world.y = segments[(segIndex + 1) % segments.length].hill;

                x += dx;
                dx += segment.curve;

                if (segment.p1.world.z <= cameraZ) continue;

                project(segment.p1, cameraX, cameraY, cameraZ);
                project(segment.p2, cameraX, cameraY, cameraZ);

                if (segment.p1.screen.y >= maxy) continue;

                // Draw grass
                drawPolygon(ctx,
                    0, segment.p2.screen.y,
                    canvas.width, segment.p2.screen.y,
                    canvas.width, segment.p1.screen.y,
                    0, segment.p1.screen.y,
                    segment.color.grass
                );

                // Draw road
                drawPolygon(ctx,
                    segment.p1.screen.x - segment.p1.screen.w, segment.p1.screen.y,
                    segment.p1.screen.x + segment.p1.screen.w, segment.p1.screen.y,
                    segment.p2.screen.x + segment.p2.screen.w, segment.p2.screen.y,
                    segment.p2.screen.x - segment.p2.screen.w, segment.p2.screen.y,
                    segment.color.road
                );

                // Draw rumble strips
                let rumbleW1 = segment.p1.screen.w / 10;
                let rumbleW2 = segment.p2.screen.w / 10;

                // Left rumble
                drawPolygon(ctx,
                    segment.p1.screen.x - segment.p1.screen.w - rumbleW1, segment.p1.screen.y,
                    segment.p1.screen.x - segment.p1.screen.w, segment.p1.screen.y,
                    segment.p2.screen.x - segment.p2.screen.w, segment.p2.screen.y,
                    segment.p2.screen.x - segment.p2.screen.w - rumbleW2, segment.p2.screen.y,
                    segment.color.rumble
                );

                // Right rumble
                drawPolygon(ctx,
                    segment.p1.screen.x + segment.p1.screen.w, segment.p1.screen.y,
                    segment.p1.screen.x + segment.p1.screen.w + rumbleW1, segment.p1.screen.y,
                    segment.p2.screen.x + segment.p2.screen.w + rumbleW2, segment.p2.screen.y,
                    segment.p2.screen.x + segment.p2.screen.w, segment.p2.screen.y,
                    segment.color.rumble
                );

                // Draw center line
                if (segment.index % 6 < 3) {
                    let lineW = segment.p1.screen.w / 50;
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(
                        segment.p1.screen.x - lineW,
                        segment.p2.screen.y,
                        lineW * 2,
                        segment.p1.screen.y - segment.p2.screen.y
                    );
                }

                maxy = segment.p2.screen.y;
            }

            // Draw cars
            cars.forEach(car => {
                let carZ = car.z - player.z;
                if (carZ < 0) carZ += trackLength;
                if (carZ > 0 && carZ < drawDistance * segmentLength) {
                    let scale = cameraDepth / (carZ);
                    let carX = canvas.width / 2 + scale * (car.x * roadWidth / 2 - cameraX) * canvas.width / 2;
                    let carY = canvas.height / 2 - scale * (0 - cameraY + cameraHeight) * canvas.height / 2;

                    if (carY > 100 && carY < canvas.height) {
                        drawCar(ctx, carX, carY, scale * 20, car.color);
                    }
                }
            });

            // Draw player car
            drawCar(ctx, canvas.width / 2 + (player.x * 100), canvas.height - 50, 1.5, '#ff6600', true);

            // Speed lines when going fast
            if (player.speed > 200) {
                ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                ctx.lineWidth = 2;
                for (let i = 0; i < 10; i++) {
                    let x = Math.random() * canvas.width;
                    let y = 300 + Math.random() * 200;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + (canvas.width / 2 - x) * 0.1, y + 50);
                    ctx.stroke();
                }
            }
        }

        // Game loop
        function gameLoop(timestamp) {
            let dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;

            if (dt > 0.1) dt = 0.1;

            update(dt);
            render();

            requestAnimationFrame(gameLoop);
        }

        // Start game
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('speedometer').classList.remove('hidden');

            player.x = 0;
            player.z = 0;
            player.speed = 0;
            score = 0;
            lives = 3;
            gameTime = 0;

            initRoad();
            initCars();

            gameRunning = true;
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalDistance').textContent = Math.floor(player.z);
        }

        // Input handlers
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
            if (e.key === 'ArrowUp') keys.up = true;
            if (e.key === 'ArrowDown') keys.down = true;
            e.preventDefault();
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
            if (e.key === 'ArrowUp') keys.up = false;
            if (e.key === 'ArrowDown') keys.down = false;
        });

        // Initialize
        initRoad();
        lastTime = performance.now();
        render();
        requestAnimationFrame(gameLoop);
    </script>
</body>

</html>