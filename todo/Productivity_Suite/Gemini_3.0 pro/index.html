<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productivity Suite</title>
    <meta name="theme-color" content="#4a90e2">
    <link rel="manifest" href="manifest.json">
    <style>
        /* --- CSS VARIABLES & THEME --- */
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --bg: #f4f7f6;
            --surface: #ffffff;
            --text: #333333;
            --text-light: #777777;
            --border: #e0e0e0;
            --shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            --radius: 8px;
            --nav-width: 240px;
        }

        body.dark-mode {
            --bg: #1a1a1a;
            --surface: #2d2d2d;
            --text: #ecf0f1;
            --text-light: #bdc3c7;
            --border: #404040;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s;
        }

        /* --- LAYOUT --- */
        aside {
            width: var(--nav-width);
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1rem;
            z-index: 10;
        }

        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        h1,
        h2,
        h3 {
            margin-bottom: 1rem;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: var(--radius);
            padding: 8px 16px;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        button.primary {
            background: var(--primary);
            color: white;
        }

        button.danger {
            background: var(--danger);
            color: white;
        }

        button:active {
            transform: scale(0.98);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text);
            margin-bottom: 10px;
        }

        /* --- NAVIGATION --- */
        .nav-item {
            padding: 12px;
            margin-bottom: 5px;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-light);
        }

        .nav-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-footer {
            margin-top: auto;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }

        /* --- SECTIONS --- */
        section {
            display: none;
            animation: fadeIn 0.3s;
        }

        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- CARDS & GRIDS --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
        }

        .stat-card {
            text-align: center;
        }

        .stat-val {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* --- SPECIFIC MODULE STYLES --- */
        /* Notes */
        .note-card {
            border-left: 5px solid var(--primary);
            height: 200px;
            overflow: hidden;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            color: var(--text-light);
            padding: 5px;
        }

        /* Todos */
        .todo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        .todo-item.completed span {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: white;
        }

        .badge.high {
            background: var(--danger);
        }

        .badge.medium {
            background: var(--warning);
            color: #333;
        }

        .badge.low {
            background: var(--success);
        }

        /* Timer */
        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            text-align: center;
            margin: 2rem 0;
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        /* Budget */
        .transaction {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        .amount.inc {
            color: var(--success);
        }

        .amount.exp {
            color: var(--danger);
        }

        /* Recorder */
        .recording-indicator {
            width: 15px;
            height: 15px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            display: inline-block;
            margin-right: 10px;
            display: none;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }

            100% {
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            aside {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                padding: 10px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .nav-item span {
                display: none;
            }

            .nav-item {
                justify-content: center;
            }

            .nav-footer {
                display: none;
            }
        }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--text);
            color: var(--bg);
            padding: 10px 20px;
            border-radius: var(--radius);
            opacity: 0;
            transition: 0.3s;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>

<body>

    <!-- SIDEBAR -->
    <aside>
        <h2 style="padding-left:10px;">üöÄ Suite</h2>
        <div class="nav-item active" onclick="showSection('dashboard')">üìä <span>Dashboard</span></div>
        <div class="nav-item" onclick="showSection('notes')">üìù <span>Notes</span></div>
        <div class="nav-item" onclick="showSection('todos')">‚úÖ <span>Todos</span></div>
        <div class="nav-item" onclick="showSection('timer')">‚è∞ <span>Timer</span></div>
        <div class="nav-item" onclick="showSection('budget')">üí∞ <span>Budget</span></div>
        <div class="nav-item" onclick="showSection('recorder')">üé• <span>Recorder</span></div>

        <div class="nav-footer">
            <div class="nav-item" onclick="toggleTheme()">üåó <span>Toggle Theme</span></div>
            <div class="nav-item" onclick="exportData()">üíæ <span>Backup Data</span></div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main>
        <!-- DASHBOARD -->
        <section id="dashboard" class="active">
            <h1>Dashboard</h1>
            <div class="grid">
                <div class="card stat-card">
                    <h3>Active Todos</h3>
                    <div class="stat-val" id="stat-todos">0</div>
                </div>
                <div class="card stat-card">
                    <h3>Balance</h3>
                    <div class="stat-val" id="stat-balance">$0</div>
                </div>
                <div class="card stat-card">
                    <h3>Notes</h3>
                    <div class="stat-val" id="stat-notes">0</div>
                </div>
                <div class="card stat-card">
                    <h3>Recs</h3>
                    <div class="stat-val" id="stat-recs">0</div>
                </div>
            </div>
            <div class="grid" style="margin-top: 20px;">
                <div class="card">
                    <h3>üìÖ Today's Priorities</h3>
                    <div id="dash-priorities"></div>
                </div>
                <div class="card">
                    <h3>‚è∞ Upcoming Reminders</h3>
                    <div id="dash-reminders"></div>
                </div>
            </div>
        </section>

        <!-- NOTES -->
        <section id="notes">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>Notes</h1>
                <button class="primary" onclick="addNote()">+ New Note</button>
            </div>
            <input type="text" id="note-search" placeholder="Search notes..." onkeyup="renderNotes()">
            <div class="grid" id="notes-grid"></div>
        </section>

        <!-- TODOS -->
        <section id="todos">
            <h1>Todos</h1>
            <div class="card">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="todo-input" placeholder="Add a new task...">
                    <select id="todo-priority" style="width: 100px;">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                    <button class="primary" onclick="addTodo()">Add</button>
                </div>
                <div id="todo-list" style="margin-top: 1rem;"></div>
            </div>
        </section>

        <!-- TIMER -->
        <section id="timer">
            <h1>Focus Timer & Reminders</h1>
            <div class="grid">
                <div class="card" style="text-align: center;">
                    <h3>Pomodoro</h3>
                    <div class="timer-display" id="time-display">25:00</div>
                    <div class="timer-controls">
                        <button class="primary" onclick="startTimer()">Start</button>
                        <button class="warning" onclick="pauseTimer()">Pause</button>
                        <button class="danger" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Reminders</h3>
                    <div style="display: flex; gap: 5px;">
                        <input type="text" id="rem-msg" placeholder="Message">
                        <input type="time" id="rem-time">
                        <button class="primary" onclick="addReminder()">Set</button>
                    </div>
                    <div id="reminder-list"></div>
                </div>
            </div>
        </section>

        <!-- BUDGET -->
        <section id="budget">
            <h1>Budget Tracker</h1>
            <div class="grid">
                <div class="card">
                    <h3>Add Transaction</h3>
                    <input type="text" id="bud-desc" placeholder="Description">
                    <input type="number" id="bud-amount" placeholder="Amount">
                    <select id="bud-type">
                        <option value="inc">Income</option>
                        <option value="exp">Expense</option>
                    </select>
                    <button class="primary" onclick="addTransaction()">Add Transaction</button>
                </div>
                <div class="card">
                    <h3>History (Total: <span id="total-balance">$0</span>)</h3>
                    <div id="budget-list" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        </section>

        <!-- RECORDER -->
        <section id="recorder">
            <h1>Screen Recorder</h1>
            <div class="card">
                <div style="margin-bottom: 20px;">
                    <span class="recording-indicator" id="rec-dot"></span>
                    <span id="rec-status">Ready to record</span>
                </div>
                <div class="timer-controls">
                    <button class="primary" onclick="startRecording()">Start Recording</button>
                    <button class="danger" onclick="stopRecording()">Stop</button>
                </div>
            </div>
            <h3 style="margin-top: 20px;">Gallery</h3>
            <div class="grid" id="video-gallery"></div>
        </section>
    </main>

    <div id="toast">Notification</div>

    <script>
        // --- STATE MANAGEMENT ---
        let data = JSON.parse(localStorage.getItem('prodApp')) || {
            notes: [],
            todos: [],
            reminders: [],
            budget: [],
            theme: 'light'
        };

        // --- INDEXED DB FOR VIDEO ---
        let db;
        const request = indexedDB.open("MediaDB", 1);
        request.onupgradeneeded = e => {
            db = e.target.result;
            db.createObjectStore("videos", { keyPath: "id" });
        };
        request.onsuccess = e => { db = e.target.result; loadVideos(); };

        // --- GENERAL FUNCTIONS ---
        function saveData() {
            localStorage.setItem('prodApp', JSON.stringify(data));
            updateDashboard();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 3000);
        }

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // Highlight nav
            const navs = document.querySelectorAll('.nav-item');
            if (id === 'dashboard') navs[0].classList.add('active');
            if (id === 'notes') navs[1].classList.add('active');
            if (id === 'todos') navs[2].classList.add('active');
            if (id === 'timer') navs[3].classList.add('active');
            if (id === 'budget') navs[4].classList.add('active');
            if (id === 'recorder') navs[5].classList.add('active');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            data.theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            saveData();
        }

        // Initialize
        if (data.theme === 'dark') document.body.classList.add('dark-mode');

        // --- DASHBOARD ---
        function updateDashboard() {
            document.getElementById('stat-todos').innerText = data.todos.filter(t => !t.completed).length;

            const bal = data.budget.reduce((acc, curr) => acc + (curr.type === 'inc' ? parseFloat(curr.amount) : -parseFloat(curr.amount)), 0);
            document.getElementById('stat-balance').innerText = `$${bal.toFixed(2)}`;
            document.getElementById('stat-notes').innerText = data.notes.length;

            // Priorities
            const priorities = data.todos.filter(t => !t.completed && t.priority === 'high').slice(0, 3);
            document.getElementById('dash-priorities').innerHTML = priorities.map(t =>
                `<div class="todo-item"><span>${t.text}</span><span class="badge high">High</span></div>`
            ).join('') || '<p style="color:var(--text-light)">No urgent tasks.</p>';

            // Reminders
            document.getElementById('dash-reminders').innerHTML = data.reminders.sort((a, b) => a.time.localeCompare(b.time)).slice(0, 3).map(r =>
                `<div class="todo-item"><span>${r.msg}</span><span>${r.time}</span></div>`
            ).join('') || '<p style="color:var(--text-light)">No upcoming reminders.</p>';
        }

        // --- NOTES ---
        function addNote() {
            const title = prompt("Note Title:");
            const content = prompt("Note Content:");
            if (title) {
                data.notes.push({ id: Date.now(), title, content, color: `hsl(${Math.random() * 360}, 70%, 85%)` });
                saveData();
                renderNotes();
            }
        }

        function renderNotes() {
            const query = document.getElementById('note-search').value.toLowerCase();
            const grid = document.getElementById('notes-grid');
            grid.innerHTML = data.notes
                .filter(n => n.title.toLowerCase().includes(query) || n.content.toLowerCase().includes(query))
                .map(n => `
                <div class="card note-card" style="border-left-color:${n.color}">
                    <h3>${n.title}</h3>
                    <p>${n.content}</p>
                    <button class="delete-btn" onclick="deleteNote(${n.id})">‚úñ</button>
                </div>`).join('');
        }

        function deleteNote(id) {
            if (confirm("Delete note?")) {
                data.notes = data.notes.filter(n => n.id !== id);
                saveData();
                renderNotes();
            }
        }

        // --- TODOS ---
        function addTodo() {
            const txt = document.getElementById('todo-input').value;
            const prio = document.getElementById('todo-priority').value;
            if (txt) {
                data.todos.push({ id: Date.now(), text: txt, priority: prio, completed: false });
                document.getElementById('todo-input').value = '';
                saveData();
                renderTodos();
            }
        }

        function renderTodos() {
            const list = document.getElementById('todo-list');
            list.innerHTML = data.todos.sort((a, b) => a.completed - b.completed).map(t => `
                <div class="todo-item ${t.completed ? 'completed' : ''}">
                    <input type="checkbox" ${t.completed ? 'checked' : ''} onclick="toggleTodo(${t.id})">
                    <span style="flex:1">${t.text}</span>
                    <span class="badge ${t.priority}">${t.priority}</span>
                    <button class="danger" style="padding:2px 6px; font-size:0.7rem" onclick="deleteTodo(${t.id})">‚úñ</button>
                </div>
            `).join('');
        }

        function toggleTodo(id) {
            const t = data.todos.find(x => x.id === id);
            t.completed = !t.completed;
            saveData();
            renderTodos();
        }

        function deleteTodo(id) {
            data.todos = data.todos.filter(t => t.id !== id);
            saveData();
            renderTodos();
        }

        // --- TIMER & REMINDERS ---
        let timerInterval;
        let timeLeft = 25 * 60;

        function startTimer() {
            if (timerInterval) return;
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    new Notification("Time's up!");
                    alert("Pomodoro Finished!");
                    resetTimer();
                }
            }, 1000);
        }

        function pauseTimer() { clearInterval(timerInterval); timerInterval = null; }
        function resetTimer() { pauseTimer(); timeLeft = 25 * 60; updateTimerDisplay(); }
        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('time-display').innerText = `${m}:${s}`;
        }

        function addReminder() {
            const msg = document.getElementById('rem-msg').value;
            const time = document.getElementById('rem-time').value;
            if (msg && time) {
                data.reminders.push({ id: Date.now(), msg, time });
                saveData();
                renderReminders();
            }
        }

        function renderReminders() {
            document.getElementById('reminder-list').innerHTML = data.reminders.map(r => `
                <div class="todo-item">
                    <span>${r.msg}</span>
                    <b>${r.time}</b>
                    <button onclick="deleteReminder(${r.id})">‚úñ</button>
                </div>
            `).join('');
        }

        function deleteReminder(id) {
            data.reminders = data.reminders.filter(r => r.id !== id);
            saveData();
            renderReminders();
        }

        // Reminder Checker
        setInterval(() => {
            const now = new Date();
            const current = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            data.reminders.forEach(r => {
                if (r.time === current && now.getSeconds() === 0) {
                    new Notification("Reminder: " + r.msg);
                    showToast("Reminder: " + r.msg);
                }
            });
        }, 1000);

        // --- BUDGET ---
        function addTransaction() {
            const desc = document.getElementById('bud-desc').value;
            const amount = document.getElementById('bud-amount').value;
            const type = document.getElementById('bud-type').value;
            if (desc && amount) {
                data.budget.push({ id: Date.now(), desc, amount, type });
                saveData();
                renderBudget();
                document.getElementById('bud-desc').value = '';
                document.getElementById('bud-amount').value = '';
            }
        }

        function renderBudget() {
            let total = 0;
            document.getElementById('budget-list').innerHTML = data.budget.map(b => {
                total += b.type === 'inc' ? parseFloat(b.amount) : -parseFloat(b.amount);
                return `<div class="transaction">
                    <span>${b.desc}</span>
                    <span class="amount ${b.type}">${b.type === 'inc' ? '+' : '-'}$${b.amount}</span>
                    <button style="margin-left:10px; padding:2px 5px;" class="danger" onclick="deleteTransaction(${b.id})">x</button>
                </div>`;
            }).join('');
            document.getElementById('total-balance').innerText = `$${total.toFixed(2)}`;
        }

        function deleteTransaction(id) {
            data.budget = data.budget.filter(b => b.id !== id);
            saveData();
            renderBudget();
        }

        // --- RECORDER ---
        let mediaRecorder;
        let recordedChunks = [];

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = saveRecording;

                mediaRecorder.start();
                document.getElementById('rec-dot').style.display = 'inline-block';
                document.getElementById('rec-status').innerText = "Recording...";
            } catch (err) {
                console.error("Error: " + err);
            }
        }

        function stopRecording() {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(track => track.stop());
            document.getElementById('rec-dot').style.display = 'none';
            document.getElementById('rec-status').innerText = "Ready";
        }

        function saveRecording() {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            recordedChunks = [];
            const id = Date.now();

            const tx = db.transaction("videos", "readwrite");
            tx.objectStore("videos").add({ id, blob, date: new Date().toLocaleString() });

            tx.oncomplete = () => {
                showToast("Recording Saved!");
                loadVideos();
            };
        }

        function loadVideos() {
            const tx = db.transaction("videos", "readonly");
            const req = tx.objectStore("videos").getAll();
            req.onsuccess = () => {
                document.getElementById('video-gallery').innerHTML = req.result.map(v => {
                    const url = URL.createObjectURL(v.blob);
                    return `<div class="card">
                        <video src="${url}" controls style="width:100%"></video>
                        <p>${v.date}</p>
                        <button class="danger" onclick="deleteVideo(${v.id})">Delete</button>
                    </div>`;
                }).join('');
                document.getElementById('stat-recs').innerText = req.result.length;
            };
        }

        function deleteVideo(id) {
            if (confirm("Delete video?")) {
                const tx = db.transaction("videos", "readwrite");
                tx.objectStore("videos").delete(id);
                tx.oncomplete = loadVideos;
            }
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'productivity-backup.json';
            a.click();
        }

        // --- INIT ---
        window.onload = () => {
            renderNotes();
            renderTodos();
            renderBudget();
            renderReminders();
            updateDashboard();
            if (Notification.permission !== "granted") Notification.requestPermission();
        };

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>

</html>